# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A Minecraft server implementation in Go (early stage). Currently includes a CLI tool (`cmd/dmd`) that downloads Minecraft protocol/game data from the PrismarineJS minecraft-data repository into the `scheme/` directory as JSON files.

## Development Environment Setup

Uses [Devbox](https://www.jetify.com/devbox) (Nix-based) for reproducible tooling. Setup:
```
direnv allow    # auto-loads environment via .envrc
devbox shell    # or use direnv for automatic activation
```

Key tools provided by devbox: Go 1.24, gofumpt, golangci-lint, gci, go-task, gopls, delve, ginkgo.

## Build & Development Commands

All commands use [Task](https://taskfile.dev) (`task <name>`):

| Command | Description |
|---------|-------------|
| `task build` | Build binary to `build/app` (linux/amd64,arm64, CGO disabled) |
| `task deps` | Download, tidy, and vendor Go dependencies |
| `task fmt` | Format code (gci for imports, gofumpt for formatting) |
| `task lint` | Run golangci-lint (runs fmt first) |
| `task test` | Run all tests with coverage |
| `task cleanup` | Remove `build/` directory |
| `task gen:dmd` | Download Minecraft data schemas |

Run a single test: `go test -mod vendor -run TestName ./path/to/package/...`

## Architecture

- **`cmd/dmd/`** — Minecraft Data Downloader CLI. Uses `hashicorp/go-getter` to fetch versioned game data (blocks, items, entities, protocol, etc.) from PrismarineJS/minecraft-data GitHub repo.
- **`internal/`** — Reserved for internal packages (currently empty).
- **`scheme/`** — Downloaded Minecraft data JSON files (protocol definitions, blocks, items, biomes, entities, recipes, etc.). Generated by `cmd/dmd`, not hand-written.
- **`vendor/`** — Vendored Go dependencies. All builds use `-mod vendor`.

## Development Rules

- **Always use `devbox run`** to execute any command: `devbox run -- <command>`. This ensures the correct Nix-managed toolchain is used. Example: `devbox run -- task build`, `devbox run -- go test ...`.
- **Always use Taskfile** for linting, building, formatting, deps, tidy, and other development commands. Never run `go build`, `gofumpt`, `golangci-lint`, etc. directly — use the corresponding `task` command instead.
- **New CLI commands**: when adding a new command under `cmd/`, always add a corresponding task to `Taskfile.yml` (or the appropriate included Taskfile).

## Code Style

- Import ordering enforced by `gci`: stdlib → third-party → `github.com/openserbia` → project module
- Formatting via `gofumpt` (stricter than `gofmt`)
- Linting via `golangci-lint`
- Build uses `-trimpath` and strips debug info (`-w -s` ldflags)
- Vendored dependencies — always run `task deps` after modifying go.mod
